\chapter{Speed Advisory}\label{ch:app}

% \begin{Summary}[Bibliographical Notes]
% This chapter is partially based on the following paper in which the author was the principal investigator:

% \cite{matthes2022selecting} \fullcite{matthes2022selecting}
% \end{Summary}

\section{Introduction}

Diverse solutions have been recently developed to make cycling smarter and increase comfort. One solution explored is warning cyclists of acute dangers along their pathway using crowdsourced data\footnote{Project Rad im Fokus: \url{https://www.synchrone-mobilitaet.de/de/projekte/rad-im-fokus.html}}. Cycling data is also used to determine accident hotspots \cite{von_stulpnagel_crash_2022}, traffic volume \cite{lissner_modeling_2018}, and cycling behavior \cite{lisner_gps-data_2020}, helping transport planners to improve infrastructure where needed. Besides targeted infrastructure enhancement, cooperative cycling and allowing cyclists to form platoons have also been recently explored as a solution to bring cyclists together, focusing on the community aspect of cycling \cite{cespedes_group_2019, meng_connected_2022}.

Given a more individualized perspective, not only bad infrastructure but also stopping at traffic lights is considered a key discomfort factor for cyclists \cite{otto_framework_2023}. Thus, several solutions are currently being tested that aim at reducing stops at intersections. One currently researched option is smartphone applications that act as virtual cyclist detectors for traffic lights, switching green phases as soon as the cyclist arrives at the intersection whenever possible\footnote{Project SiBike (now YuBike): \url{https://www.de.digital/DIGITAL/Redaktion/DE/Smart-City-Navigator/Projekte/sibike-app.html}}. A more passive option is employing static info boards, LED lines, or other visual cues at intersections that help cyclists adjust their speeds \cite{de_angelis_green_2019}. In a recent project, "Leezenflow," researchers were able to achieve a 6.6\% stop reduction at one traffic light in Münster that was equipped with a countdown timer \cite{brand_riding_2024}, leading to a 75.9\% perceived increase in cycling quality. This research is related to studies on green signal countdown devices (GSCDs) installed mainly in the US and China to reduce dilemma zones \cite{lum_before-and-after_2006, huang_evaluating_2014, ni_estimating_2014, chen_exploring_2015, islam_improved_2016}. 

A non-static option is the deployment of a GLOSA application to cyclists. Compared to static info boards, such an application has the potential to be applied to thousands of traffic lights without larger financial expenses, provide a more individual speed advisory, and act as a smart platform for other cycling services. Thus, a mobile application can be seen as advantageous in many ways. The goal of this chapter is to develop such a solution for cyclists, deploy this solution in the large-scale urban environment of Hamburg, and test its impacts. To achieve this solution, we will reuse the developed foundations from \Cref{ch:prediction} (traffic light prediction), \Cref{ch:matching} (traffic light matching), and \Cref{ch:routing} (accurate bike routing).

First, we will study previous GLOSA applications with a focus on developed user interfaces. Among a general study of ways to communicate a speed advisory, we will also discuss previous results regarding usability and cognitive load. Afterward, we will focus on impacts that have been reported in previous works for motorized vehicles and cyclists. Our concept focuses on identifying the best user interface for cyclist speed advisory, and presents auxiliary features that aim at maximizing the app's usability. A final application architecture is presented, highlighting the integration of previously developed services. A usability analysis aims to identify the perceived benefits and drawbacks of our developed mobile application during extensive long-term field tests. This qualitative study is supplemented with a thorough analysis of user trajectories, including an evaluation of stop reduction and estimated energy savings. With our results from the qualitative and quantitative study, we conclude the impacts of our developed speed advisory on cyclists. 

\section{Related Work}\label{sec:rw-uis}

Studies on the effect of a traffic light speed advisory have been conducted in various different experimental contexts. As a result, diverse user interfaces and measurements of the speed advisory's impact have been contributed over time. 

While traffic-light-predictive cruise control systems have been demonstrated which directly influence a vehicle's powertrain \cite{raubitschek_predictive_2011}, the user interface can be seen as an integral part of GLOSA systems. However, the relation between a user interface and reaction to a speed advisory has not always been tested in correspondence, meaning that many studies have been conducted without a human in the loop. To emulate a reaction to the speed advisory, simulation studies typically utilize a driver model \cite{hu_lane-level_2023}, including the vehicle's acceleration behavior and, occasionally, additional factors such as human interaction delay \cite{schlamp_2023_glosa}. Another dimension is introduced by studies that investigate the impact of a speed-advised lead vehicle onto subsequent vehicles \cite{preuk_does_2016, preuk_should_2018}. In many of these studies, constant user obedience and a usable speed advisory are assumed.

However, there has also been recent criticism about the realism of many of the conducted simulation studies. Klöppel et al. (2019) \cite{kloeppel_performance_2019} conclude that individual aspects required for a realistic impact simulation are often neglected. Many studies that have painted an optimistic picture of potential effects fall short of depicting a realistic response to the speed advisory, according to the authors. Due to these limitations, the demand for holistic, real-world studies has increased \cite{stahlmann_exploring_2018}. Such a holistic study must also consider the user interface and its guidance efficacy. 

The following sections will explore the research on speed advisory from different perspectives. First, we will look at the diverse landscape of possible user interfaces, identifying the drawbacks and advantages for cyclist applications. Broadening the view towards non-visual interfaces allows us to identify new ideas to convey a speed advisory. Previous experiments with speed advisory on cyclists and usability studies are discussed, inferring current challenges and knowledge gaps that could be addressed with a novel design. Finally, we summarize the reported effects of the speed advisory on traffic participants in relation to experimental circumstances. The reported energy savings and stop reductions will serve as a baseline at the end of this chapter.

\subsection{User Interfaces}

Diverse user interfaces have been proposed over time to present a traffic light speed advisory. Often, multiple interfaces are tested in conjunction.

In various studies, a target speed is directly recommended. Otto et al. (2010) \cite{otto_operating_2010} employ speed signs, similar to those found on the roadside, to encourage users to slow down when approaching a red traffic light at normal driving speed. Koukoumidis et al. (2011) \cite{koukoumidis_signalguru_2011, koukoumidis_leveraging_2012} recommend a specific speed, presenting the recommendation not only as a speed limit but also as an acceleration suggestion. Mahler et al. (2012) \cite{mahler_reducing_2012} adopt a similar approach. Zweck et al. (2013) \cite{zweck_traffic_2013} demonstrate the implementation of target speed recommendation in an Audi's onboard computer. Olaverri-Monreal et al. (2018) \cite{olaverri-monreal_implementation_2018} show a similar integrated visualization in the onboard computer of a simulated vehicle. BMW's EnLighten System also utilizes an infotainment display, as indicated by Sokolov et al. (2018) \cite{sokolov_effects_2018}. Except for integration methods, these approaches share similar design principles. In the background, a model determines the best achievable green phase and calculates the required target speed, which is then presented more or less directly in textual form.

Some works apply a slight variation to the target speed advisory user interface, such as in a work by Parella (2019) \cite{marias_parella_design_2019}, where the target speed is marked on the speedometer instead of being displayed as text. Xu et al. (2015) \cite{xu_bb_2015} demonstrate a hybrid approach based on a target speed advisory using auditory prompts. Vibration-based inputs for speed recommendations are also discussed, particularly in cycling contexts \cite{cespedes_group_2019}, though not extensively explored in the context of GLOSA. The Signal2X App by Yunex \cite{yunex_traffic_v2x-kommunikation_2023} and Bhattacharyya et al. (2022) \cite{bhattacharyya_assessing_2022} not only display target speed for a single but also for multiple parallel traffic lights. Another variation in target speed advisory is found in the cycling study by Fickas et al. (2019) \cite{fickas_fast_2019}. Instead of displaying the target speed, arrows indicate weak or strong acceleration or braking recommendations to achieve the target speed. However, the situational awareness of this approach was found to be an issue, especially in hilly terrain or other challenging situations.

The second most common visualization is the countdown to the next traffic light change (Time-to-Green or Time-to-Red). This method is simpler, requiring no model for green phase selection or precise distance estimation to the traffic light. Usually, a countdown is presented alongside the target speed \cite{koukoumidis_signalguru_2011, koukoumidis_leveraging_2012}. Audi's GLOSA system, for example, switches from displaying the target speed to the countdown when the vehicle is stationary at a traffic light \cite{zweck_traffic_2013}. BMW's EnLighten System also features both target speed and countdown displays \cite{sokolov_effects_2018}. When standing at the red light, the countdown is typically hidden five seconds before the traffic light switches to avoid premature acceleration \cite{stahlmann_exploring_2018, sokolov_effects_2018}. Otto et al. (2010) \cite{otto_operating_2010} demonstrate the feasibility of visualizing information for multiple parallel lanes, a concept also implemented by Jacob et al. (2020) \cite{jacob_ivs-kom_2020}, Khan et al. (2021) \cite{khan_eco-drive_2021}, and the Yunex Signal2X App \cite{yunex_traffic_v2x-kommunikation_2023}. Some studies accompany the countdown with auditory signals. Chen et al. (2022) \cite{chen_developing_2022} audibly convey the countdown every 2 seconds to the user. Wilson et al. (2017) \cite{wilson_driver_2017} tested an auditory warning and a "Prepare to Go" signal, indicating an imminent traffic light change.

The third most popular visual representation of speed recommendation involves projective methods, where the traffic light prediction is projected onto the road (Lane Projection, Carpet) or onto a speedometer. While a specific speed is not selected, an accurate distance estimate and prediction of multiple phases are required. The Carpet visualization, initially proposed by Otto et al. (2010) \cite{otto_operating_2010}, involves shifting a prediction carpet through acceleration or deceleration to stay within the green phase, resembling a green wave on which users can "jump on." This method allows for visualizing uncertainties in the prediction by blurring the phase areas, a large advantage over countdowns or target speed displays. Bernais et al. (2016) \cite{bernais_design_2016} also utilize this visualization, modifying it to display multiple lane carpets side by side. Suzuki et al. (2018 -- 2020) \cite{suzuki_new_2018, suzuki_safety_2020} demonstrate that this visualization method can also be implemented in a car's heads-up display by projecting the carpet's colors into the driver's field of view. Besides the carpet visualization, the speedometer visualization operates quite similarly, projecting the prediction along speeds on the speedometer's speed arc. This method was first tested in the field by Xia et al. (2012) \cite{xia_field_2012} and later reused by Hao et al. (2019) \cite{hao_eco-approach_2019}. Parella (2019) \cite{marias_parella_design_2019} shows a combination of target speed and speedometer.

Except for countdown visualization, Krause et al. (2012) \cite{krause_traffic_2012} investigated the usability and distraction of these visualizations. Two additional visualization types, "Fisheye" and "Roll," were introduced, similar to the evaluated Carpet projection but with a colored number band instead of a colored surface area. Usability was evaluated using the System Usability Scale (SUS) and the AttrakDiff Score. The Tacho projection scored the highest with a SUS of 80.4, followed by the Carpet visualization (75.3), Roll (73.9), Fisheye (58.8), and target speed recommendation (56.5). The AttrakDiff Score mirrored these results. While target speed recommendation, the most frequently used visualization, performed poorly in terms of usability, the Speedometer method emerged as the most promising in the simulator experiment. Krause et al. (2012) \cite{krause_traffic_2012} also examined the impact of visualization on distraction. Users spent the least time looking at the poorly rated target speed recommendation, although the off-road glance duration was, in part, longer, potentially due to shifting focus between the recommended speed and the vehicle speedometer. Minimal differences were observed between the other visualizations, indicating no clear winner.

The studies by Krause et al. (2012) \cite{krause_traffic_2012} and findings by Fickas et al. (2019) \cite{fickas_fast_2019} suggest that target speed recommendation is likely not a good option, while the less explored speedometer visualization appears most promising in terms of usability. Few studies, apart from Wilson et al. (2017) \cite{wilson_driver_2017}, have investigated usability, with the SUS score testing BMW's EnLighten System at an average of 71.4 (SD = 12.6). However, this study identified various factors negatively affecting usability, notably the loss of GNSS connectivity during driving. Thus, user acceptance of a speed recommendation app depends not only on the visualization method but also on the overall functionality of the app.

Different approaches have been explored for integrating speed recommendations into overall systems. In works by Xia et al. (2012) \cite{xia_field_2012}, Zweck et al. (2013) \cite{zweck_traffic_2013}, and later by Stahlmann et al. (2018) \cite{stahlmann_exploring_2018}, the focus is on the overall vehicle system. The speed recommendation is linked with other infotainment components and receives crucial additional information, such as turn signal status, from the vehicle information system, as seen in Audi's system. BMW's EnLighten System was tested in two forms: as an integrated system in the vehicle \cite{sokolov_effects_2018} and previously as a mobile app \cite{wilson_driver_2017}, presumably using the smartphone as a prototyping environment. Smartphone app development has often followed a "ride as you go" approach \cite{otto_operating_2010, koukoumidis_signalguru_2011, koukoumidis_leveraging_2012, bernais_design_2016, wilson_driver_2017, zhang_green_2020, khan_eco-drive_2021, yunex_traffic_v2x-kommunikation_2023}. This approach allows users to start driving without choosing a route beforehand. However, several works reported issues with GNSS accuracy, especially in traffic light selection \cite{wilson_driver_2017, stahlmann_exploring_2018, bhattacharyya_assessing_2022}.

Mahler et al. (2012) \cite{mahler_reducing_2012} proposed an alternative approach: instead of starting immediately, users should specify a route before driving. This allows the app to preselect traffic lights along the route. The advantages of such an approach were discussed in \Cref{ch:matching} and \Cref{ch:routing}. Another indication of the potential suboptimality of the Ride-as-you-go approach comes from user reviews of the TrafficPilot App, where the ability to calculate routes is frequently perceived as a missing feature.

Two recent works demonstrate how such integration could look. Bhattacharyya et al. (2022) \cite{bhattacharyya_assessing_2022}, associated with the CTD App, presents GLOSA as a component of a connected navigation app. The app switches between different functional views in various situations, displaying recommended speeds on parallel lanes as the vehicle approaches an intersection. In a recent study by Ding et al. (2023) \cite{ding_speedadv_2023}, the presentation is integrated as an additional element in a navigation app, showing a small circle with the target speed. The relevant traffic light for turning is also selected.

Thus, a combination of GLOSA and a navigation app seems to be a promising current approach, although few insights are available on how well existing GLOSA systems are received by users.

\subsection{Impacts}

\begin{figure}
\centering
\resizebox{\linewidth}{!}{%
\input{images/related-work-energy-savings.pgf}
}
\caption{Reported energy/emission savings in GLOSA studies.}
\label{fig:related-work-energy-savings}
\end{figure}
Studies on impacts can be divided into three aspects: quantitative measurements of energy savings, as depicted in \Cref{fig:related-work-energy-savings}; quantitative measurements of delay reduction at intersections; and qualitative effects on subjective perception.

To measure energy savings, fuel consumption is commonly measured directly, or as a proxy, carbon dioxide (CO2) emissions are considered. It is assumed that CO2 emissions are linearly related to fuel consumption \cite{seredynski_comparison_2013, seredynski_multi-segment_2013}. Thus, relative savings without and with Green Light Optimal Speed Advisory (GLOSA) should be comparable, though dependent on the experimental setup.

The determined values span a diverse range, as shown in \Cref{fig:related-work-energy-savings}. The median is 16\% (IQR: 26\%) reduction in emissions/energy, but significantly higher energy savings are reported in some cases. Possible explanations are found in the experimental setups. For instance, Li et al. (2014) achieved a 69.3\% savings through MATLAB simulations in free-flow conditions with one intersection, assuming a sufficiently wide activation distance \cite{li_multi-vehicles_2014}. Mahler et al. (2012) reported a 60 -- 66\% savings in a custom simulation environment with three intersections, neglecting traffic during simulation \cite{mahler_reducing_2012}. Asadi et al. (2011) demonstrated 47\% less fuel with 56\% less CO2 emissions in a single-vehicle (freeflow) scenario with 9-11 intersections, using PSAT (MATLAB) and an activation distance of 1000m \cite{asadi_predictive_2011}.

The actual energy savings in everyday situations for cars and larger motorized vehicles are notably lower. The highest directly measured savings on a real vehicle are 22.1\%, reported by Chen et al. (2022) \cite{chen_developing_2022}, involving a bus driving without traffic over a test track with two traffic lights. In another study by Hao et al. (2019), a 6\% savings was measured in a test track scenario \cite{hao_eco-approach_2019}.

Evaluations conducted in real traffic settings show savings of 20.3\% \cite{koukoumidis_signalguru_2011} and 13.59\% \cite{xia_field_2012}. However, there are generally few studies of this nature, often considering only a few or a single intersection, thus not truly examining everyday driving scenarios. Xu et al. (2015) found 15.1\% savings in tests with three intersections in Beijing, conducted at night to avoid interference with other vehicles \cite{xu_bb_2015}. Khan et al. (2021) measured energy savings of 5\% in a test with 1187 intersections in Ottawa, Canada, equipped with GLOSA-enabled apps on 830 vehicles, using recorded driving data over eight weeks \cite{khan_eco-drive_2021}.

For electric bicycles, Tal et al. (2016) reported savings of 32 -- 46\% in an iTETRIS (SUMO) simulation, testing at a single intersection. The energy savings were measured using a consumption model that considered air resistance, road inclination, and rolling resistance \cite{tal_vehicular-communications-based_2016}. Dabiri et al. (2020) employed a similar model, including acceleration \cite{dabiri_optimized_2020}. However, actual energy savings during everyday cycling have not been measured for cyclists.

\begin{figure}
\centering
\resizebox{\linewidth}{!}{%
\input{images/related-work-stops.pgf}
}
\caption{Reported stop time/rate savings in GLOSA studies.}
\label{fig:related-work-stops}
\end{figure}

The second investigated impact is the reduction in stop time or stop rate and has primarily been measured in simulations. Karoui et al. (2018) \cite{karoui_efficiency_2018}, Sharara et al. (2019) \cite{sharara_impact_2019}, and Xie et al. (2021) \cite{xie_dynamic_2021} report reductions of up to 100\% in favorable conditions, indicating a complete avoidance of stopping at intersections. However, most measurements are considerably lower, with a median of 61\% (IQR: 61\%). It is likely that the actual time savings at stops in reality are significantly lower. Suramardhana et al. (2014) \cite{suramardhana_driver-centric_2014} provide a single data point for stop time reduction in a real-world setting, reporting a 23.9\% reduction when approaching a test track intersection in Korea.

Regarding stop rate reduction, there are a few measurements with a median of 45\% (IQR: 30\%). Only one field study, conducted by Xu et al. (2015) \cite{xu_bb_2015}, directly measured a reduction from 21 to 15 stops (28.6\%). It's important to note that this measurement was taken at night, and generally, only a few trips were conducted. Fickas et al. (2019) \cite{fickas_fast_2019} did not directly measure stop rates for cyclists but reported successful guidance of cyclists through green lights in most cases. The extent to which stops are reduced for cyclists in everyday rides, particularly across numerous traffic lights using GLOSA, remains largely unknown.

Regarding subjective impacts of the speed advisory, Khan et al. (2021) \cite{khan_eco-drive_2021} explore both quantitative and subjective impacts of speed advisory systems. Based on a survey of 100 users, the speed advisory was predominantly rated as "somewhat useful" (70 times). Of the respondents, 53 indicated that the speed advisory made driving more relaxed, while 35 perceived no difference from the normal situation, and 12 felt more anxious. Most participants reported adapting to the speed advisory in approximately 25\% (47 participants) or 50\% (29 participants) of cases, while 12 participants did not adapt at all. In 232 out of 2354 cases (9.9\%), it is presumed that surrounding traffic prevented adaptation despite the traffic light being green, leading the vehicle to slow down to under 20 km/h. A similar scenario was reported in Fickas et al.'s (2019) bicycle-related study \cite{fickas_fast_2019}, where other cyclists "clogged" the bicycle lane, making it unsafe to follow the speed advisory. The overall usefulness of the app or whether comfort could be improved was not assessed. However, some participants occasionally felt pushed out of their comfort zone to follow a speed advisory perceived as too slow or too fast.

The effectiveness of speed advisories depends not only on the subjective willingness to follow them but also on various contextual factors. Sokolov et al. (2018) \cite{sokolov_effects_2018} and Preuk et al. (2016-2018) \cite{preuk_does_2016, preuk_should_2018} highlight the impact on other road users, emphasizing that other road users perceive a vehicle using speed advisory as disruptive unless informed about it.

Overall, the effectiveness of speed advisories improves with a higher penetration rate (MPR). Bhattacharyya et al. (2022) \cite{bhattacharyya_assessing_2022} reported energy/fuel savings of 3\% -- 5\% (MPR 30\%), 10\% (MPR 50\%), 15\% (MPR 100\%). The activation distance and transmission rate of prediction messages also play a significant role in the effectiveness of speed advisories, as shown by Sharara et al. (2019) \cite{sharara_impact_2019}. Given an MPR of 30\%, Bhattacharyya et al. (2022) \cite{bhattacharyya_assessing_2022} measure a stop time reduction of 3\% with 300m activation distance, 62\% with 500m, and 75\% with 1000m. Activation distances typically range from 200 to 300 meters in most studies \cite{xia_indirect_2011, raubitschek_predictive_2011, rakha_eco-driving_2011, rakha_aeris_2012, mahler_reducing_2012, tal_vehicular-communications-based_2016, xu_bb_2015, de_nunzio_eco-driving_2015, luo_green_2017, kloeppel_performance_2019, dabiri_optimized_2020, hu_lane-level_2023}, aligning approximately with real-world measurements \cite{bernais_design_2016}. However, some studies consider scenarios with approach distances exceeding 1000 meters \cite{tielert_impact_2010, asadi_predictive_2011, krajzewicz_preparing_2012, nguyen_efficient_2016, karoui_efficiency_2018, plianos_predictive_2018, sharara_impact_2019, simchon_real-time_2020, bhattacharyya_assessing_2022}.

In conclusion, as highlighted by Klöppel et al. (2019) \cite{kloeppel_performance_2019}, while numerous studies have been conducted on the impact of Traffic Light Assistance Services on road users, many results are likely overly optimistic, underestimating the complexity of tests in everyday driving in the real world. The research gap is even more apparent for cycling studies compared to tests on cars or other larger motorized vehicles, leaving the impacts of GLOSA on cyclists in everyday city-wide use largely unresolved.

\begin{Summary}[Summary of Research Gap]
A clear interrelation between the user interface and the speed advisory's effectiveness can be identified. Although many studies present a target speed to the user, this type of user interface can be seen as the least suitable option based on usability and cyclist studies. Countdown displays or projective speed advisories (Carpet, Speedometer) are identified as better options, as they allow a more self-determined decision of acceleration or deceleration. Projective methods have the additional advantage of conveying prediction uncertainties. Most systems operate on a "ride as you go" approach, which does not require users to preselect a route and instead utilizes the device's GNSS to display speed advisories. However, routing is experienced as a missing feature and may resolve other issues related to GNSS connectivity and accuracy. Integrating a GLOSA system with a (bike) navigation is seen as one potential avenue for improvement, while the experienced completeness of the software product also plays a role in usability.

Impacts have been determined mainly through savings in energy expenditure, stop rate/time, as well as user opinions. With some simulation estimates reaching up to 69.3\% in potential savings, real-world measurements lower this estimate drastically. Results for electric bicycles indicating 32 -- 46\% energy savings remain to be cross-tested in a large-scale urban environment. Stop times are reported to be substantially decreased, although real-world measurements also reside lower than predicted by simulations. If given the decision, users do not always follow the speed advisory. On the other hand, recommending a target speed directly is felt to pressure users, over- and underestimating the cyclist's comfort speed occasionally. Besides the willingness to follow the speed advisory, other traffic participants may obstruct the intended behavior in some cases, with the activation distance being a key limiter for the speed advisory's effectiveness. These factors contribute to the high complexity of real-world deployments, requiring further studies, especially with cyclists, to determine the usefulness of bike-GLOSA.
\end{Summary}

\section{Concept}

The proposed concept addresses these research gaps as follows. All three identified visualization methods for the speed advisory are tested preliminarily to derive a thorough understanding of their individual drawbacks and advantages within a real-world cycling context. In correspondence with learnings from previous works, a speedometer projection with a traffic light countdown is selected as the final choice. This approach allows us to enhance both cycling situations: standing at a red light and adjusting one's speed driving towards it.

As opposed to a "ride-as-you-go" approach, we follow a route-based speed advisory that was determined to be promising in many ways but is fairly unexplored in related work. A map and calculated bike route are presented in conjunction with the speed advisory, allowing users to pinpoint their directions and for which traffic light a speed advisory is currently given. Here, a strong focus is established on minimizing cognitive load and interaction during rides. Before the ride, additional bike routing features help make informed routing decisions, such as identifying route sections with and without speed advisories. 

The presented final application is intended as a companion for day-to-day bike rides, bringing all developed components from previous chapters together: traffic light prediction, traffic light matching, and accurate bike routing. By delivering the smartphone application to voluntary users in Hamburg, we collect user feedback and trajectory data for our final evaluation of the speed advisory's impact on cycling behavior. In this way, we capture the full complexity of an unsupervised real-world deployment on a city scale.

\subsection{Preliminary Approaches}

\begin{figure}[t]
\centering
\includegraphics[width=\linewidth]{images/graph-based-speed-recommendation.pdf}
\caption{Simple speed recommendation algorithm used in initial tests.}
\label{fig:graph-based-speed-recommendation}
\end{figure}

Out of three user interface prototypes, one was selected for our deployment and test with users in Hamburg. Two user interfaces had shown in preliminary experiments to be less appropriate, and were thus not followed further: the target speed advisory and the multi-lane projection. We will briefly discuss the learnings from these approaches, as they have been crucial in shaping the final solution.

\Cref{fig:graph-based-speed-recommendation} illustrates our initial approach, the target speed advisory. In this approach, a text-based speed recommendation is provided to the user, accompanied by a static color-coded scale indicating alignment with the green phase. An ideal speed is determined based on a simple algorithm that incorporates the estimated traffic light distance and the traffic light's prediction. Based on the estimated speeds to arrive at the start or end of each predicted green phase, the closest target speed is selected to minimize the required speed adjustment. In case no speed adjustment is required to arrive at green, the currently driven speed is recommended. To incorporate prediction uncertainties in the speed advisory, an uncertainty padding is added to the predicted green phases. Finally, sanity checks are implemented to clamp the speed advisory to realistic speeds.

We experimented with this approach on a test track in Dresden. Two mobile traffic lights were set up on TU Dresden's campus, with a circular test track around the "Friedrich List" Faculty of Transport and Traffic Sciences. The traffic lights were equipped with fixed-time programs and positioned alongside a shared bike/footpath, where they would not interfere with automotive traffic. Based on this test setup, the following limitations were identified.

First, there was the issue of speed fluctuations and oscillation around the target speed. Presumably caused by GNSS inaccuracies and latencies in the recalculation of the GNSS speed, the difference between the target speed and the user's actual speed fluctuated from second to second, leading to a perceived lack of responsiveness. Since the user location (together with its speed) is maximally sampled once per second, we experienced stuttering recommendations instead of a smooth and continuous experience. This often resulted in excessive over- or under-compensation to reach the target speed, leading to an overall poor user experience. This issue could have been partially addressed by an external speed sensor or additional effort to incorporate the inertial smartphone sensors.

Due to similar reasons, the second issue of our approach was that it failed to consider acceleration inertia in the speed advisory calculation process. The calculation assumed that the user could instantly adjust to the recommended speed. However, the longer it took to match the speed recommendation, the greater the discrepancy became. Consequently, we felt a constant need to chase the speed recommendation, which contributed to a sense of dissatisfaction. Overall, our speed advisory model would have required a much more sophisticated motion estimation to address this problem.

Another difficulty related to modeling the cyclist's movement is considering the user's limits and capabilities. The speed advisory algorithm has to make assumptions about the user's physical abilities to accelerate and decelerate in a specific scenario. Similar to the work of Fickas et al. (2019) \cite{fickas_fast_2019}, we found this to be a major drawback, as users could be impeded by traffic or physically unable to meet the recommendations, leading to disappointment when a recommended speed can't be achieved. Even more frustration can occur with a false speed advisory after having spent additional energy to follow the recommended speed. While factors like incline in the path, surface quality, or the type of bike chosen (e-bike vs. regular bike) could be inferred with our route-based approach, not all real-world aspects perceived by the user can be adequately captured.

With our approach, there was also the risk of recommending a speed that conflicts with the user's intentions, as the system decides a speed for the user. However, the user's intention may be to ride comfortably while feeling pressured by the app to speed up. In situations where there is ambiguity, with some users opting to speed up while others prefer to slow down, the speed recommendation effectively works against one of these groups. We found no good ideas on how this challenge could be addressed.

Finally, there is the issue of prediction uncertainties. While previous works 

\begin{enumerate}
\item \textbf{Consideration of user limits and capabilities:} The speed advisory algorithm has to make assumptions about the user's physical abilities to accelerate and decelerate in a specific scenario. This is a major drawback, as users could be impeded by traffic or physically unable to meet the recommendations, leading to disappointment when a recommended speed can't be achieved. Even more frustration can occur with a false speed advisory after having spent additional energy to follow the recommended speed. While factors like incline in the path, surface quality, or the type of bike chosen (e-bike vs. regular bike) could be partially used to model the user's capabilities, not all real-world aspects perceived by the user can be adequately captured.
\item \textbf{Conflict with user intentions:} When providing a target speed recommendation, the system decides a speed for the user. However, the user's intention may be to ride comfortably while feeling pressured by the app to speed up. In situations where there is ambiguity, with some users opting to speed up while others prefer to slow down, the speed recommendation effectively works against one of these groups. Hence, it is generally desirable to offer multiple target speeds to provide users with some freedom of choice.
\item \textbf{Explainability of prediction uncertainties:} Another challenge is displaying the prediction's uncertainty to users. Although it is possible to incorporate the prediction's uncertainty into the calculation process, this process happens in the background and is not clear to the user. For example, the speed advisory may overly slow down the user (focusing on a certainly green part of the prediction) when the traffic light becomes green much earlier in the real world. The user could interpret this intended behavior as an imprecise speed advisory.
\end{enumerate}
 
These observations culminate in the following conclusion: in the context of bike-GLOSA apps, smartphones cannot model the real-world situation more adequately than the cyclist himself. Thus, the smartphone will likely make a less proper target speed decision than the user, given the same traffic light prediction. Therefore, it is important to investigate speed advisory user interfaces that allow users to flexibly choose between green phases of the upcoming signal: projection methods.

\begin{figure}[htbp]
\centering
\includegraphics[width=\linewidth]{images/multi-lane-view.png}
\caption{Multi-lane matching and preliminary implementation of multi-lane speed recommendation.}
\label{fig:multi-lane-view}
\end{figure}

The multi-lane projection involves displaying multiple parallel lanes for upcoming traffic lights, with the prediction projected onto these virtual lanes. The user's location and speed are rendered above these lanes, allowing the user to slow down or speed up to move the prediction underneath. As the intersection comes closer, the lane's end (stop line) moves toward the user. This approach can be implemented by looking up all signals on intersections along the route which match the route's direction. The process is depicted in \Cref{fig:multi-lane-view}. Since all possible speeds are displayed, the user can flexibly choose between possible speeds. Furthermore, not a single traffic light is matched but multiple parallel signals at the intersection. This means that the user can select the appropriate signal, simplifying the traffic light matching process.

However, this approach comes with its own drawbacks. The main drawback is the visualization's readability while riding. With multiple parallel signals being displayed, users have to mentally correlate the shown lanes with the real-world situation ahead and process predictions for multiple parallel lanes simultaneously. Another challenge lies in moving the predicted traffic light colors intuitively towards the signal, resembling a flow in which the user can "jump on." A problem is choosing a suitable zoom scale for the prediction, such that users can differentiate when they will be "caught" or "run into" a red signal. Similar to the initial color-coded scale, users also have to get used to the direction of movement that they can induce when they speed up or slow down. Due to these concerns about the approach's usability and potential for distraction, another speed advisory user interface was tested: the speedometer projection.

\subsection{Combined Approach with Speedometer and Countdown}

\begin{figure}[htbp]
\centering
\includegraphics[width=\linewidth]{images/speedometer-adaptions.png}
\caption{Final speed recommendation concept and adaption mechanisms for varying prediction quality.}
\label{fig:speedometer-adaptions}
\end{figure}

The final speed advisory visualization aims to integrate the strengths and mitigate the weaknesses of both previous approaches. It involves building a visualization around a speedometer, a widely recognized and, thus, probably more intuitive instrument for representing speed. Unlike the multi-lane visualization, only one relevant traffic light is selected by matching a sequence of upcoming traffic lights through the route geometry.

As confirmed preliminarily through initial field tests, this approach represents a noticeable improvement over both other approaches. The speedometer allows users to focus more on the real-world situation and occasionally glance at the display to determine if they are within a green window. Similar to the multi-lane visualization, the choice of target speed is entirely externalized to the user, and no speed recommendation algorithm is required. Hence, users have the freedom to select any target speed based on their current physical and contextual circumstances. This means that there is no potential for recommendation error and no need for advanced speed recommendation models. The only challenge that comes with this approach is precisely selecting the upcoming traffic light along the pathway. Since only one traffic light (instead of multiple parallel signals) is focused, the traffic light selection process has to be much more advanced.

To address prediction uncertainties, the speedometer incorporates a mapping of these uncertainties by adjusting the opacity of the green or red colors. This adaption is also highlighted in \Cref{fig:speedometer-adaptions}, and conveys certain and uncertain parts of the prediction to the user. Although this opacity mapping is also possible with the multi-lane visualization, the speedometer's prediction arc utilizes the available screen space much more efficiently, which makes the prediction uncertainties more easily conceivable. To avoid users adapting to a poor speed recommendation, the speed advisory is only displayed if the prediction quality is above 50\%. Additionally, to compensate for fluctuations in the measured GNSS speed, a smooth animation is applied to the speedometer needle. On top, a time-to-green (or time-to-red) countdown has been included at the center of the speedometer. This countdown is hidden either 5 seconds before the traffic light switches or if the prediction quality is too low, avoiding jump starts or inadvertently running a red light. This idea was adopted from other time-to-green displays observed in Dresden that are mounted onto a traffic light and hide their countdown a few seconds before switching as well.

To conclude this section, three identified visualization methods have been investigated and thoroughly tested. Observed disadvantages of other visualizations ultimately lead to the conclusion that the speedometer visualization is the best possible speed advisory visualization for cyclists. Thus, this design is selected as the final approach.

\subsection{Integration with Bike Routing}

\paragraph{Camera Controller for Improved Traffic Light Visibility:} The main purposes of the map view are to display the user's current route and to show which signals are along the way. In this way, the user sees if a traffic light is connected to the TLD system and for which traffic light the current speed advisory is displayed. Initially, a camera was implemented that strictly follows the user's position and heading at a fixed height. However, often, the currently selected traffic light was out of view, or the camera was too far away at an intersection or a specific turn. Thus, the map's camera has to dynamically adjust its height depending on the situation, but without being distractive.

Furthermore, there would be occasions when road bends were between the user and the signal. In this case, since the heading of the user was strictly followed, the route would curve away from the map view, making it hard to see the upcoming signal. Through studying other navigation apps, it was observed that Apple Maps employs a slight rotation of the map to provide users with a better overview of upcoming turns. A screenshot of this behavior is highlighted in \Cref{fig:camera-controller}. This behavior, in addition to automated zooming, was adopted to improve the overall usability and self-sustainedness of the map view.

\begin{figure}[htbp]
\centering
\includegraphics[width=\linewidth]{images/camera-controller-1.png}
\includegraphics[width=\linewidth]{images/camera-controller-2.pdf}
\caption{Dynamic camera adaption in different scenarios.}
\label{fig:camera-controller}
\end{figure}

During a ride, the app continuously checks if the user is approaching a traffic light by examining the route segments from the user's location. A turn is detected when a route segment is found that deviates at least 15° from the user's measured heading. As the user approaches a turn or traffic signal, the camera automatically zooms in to focus on the intersection, making it easier for users to locate a path entry or identify a corresponding signal. Additionally, the camera rotates slightly (up to a maximum of 20°) away from the user to ensure that the traffic lights remain within the view frustum. These threshold values have been determined empirically through extensive real-world testing. To prevent excessive zooming, the camera operates within specified maximum and minimum zoom levels, avoiding zooming too far out or too far in.

\paragraph{Prediction Availability:} As discussed previously, predictions and, therefore, speed recommendations are not available for all intersections in Hamburg. Furthermore, traffic-adaptive signals or data outages may lead to low-quality or missing predictions. Therefore, it is crucial for the user to see along which route segments a speed advisory can be expected. To communicate the prediction availability to users, the route is highlighted in green wherever a "green wave" can be expected.

\begin{figure}[htbp]
\centering
\includegraphics[width=\linewidth]{images/routing-process-quality-mapping.png}
\caption{Visualization of traffic light groups and prediction quality along the calculated route.}
\label{fig:routing-process-quality-mapping}
\end{figure}

To match the prediction qualities onto the route, two steps illustrated in \Cref{fig:routing-process-quality-mapping} are performed: First, the signals are matched along the route. Afterward, the obtained traffic light IDs along the route are utilized to fetch and map the prediction qualities generated by the prediction monitor. Finally, the route is colorized with respect to the prediction quality. No prediction means the route is not colored green. A prediction with less than 50\% quality is also not displayed as green since no speed advisory is activated. Upwards, the color is interpolated between the default route color (50\% quality) and green (100\% quality). 

There are several factors that can influence a cyclist's route choice. For instance, cyclists may opt for a slightly less optimal route if it offers better surface quality. One approach is to incorporate this information directly into the routing profile to ensure that each user receives an enhanced routing decision. This is already supported by GraphHopper's routing profiles, defining different speeds for each \texttt{vehicle} depending on the road segments' metadata. However, it is important to acknowledge that GraphHopper's routing profiles are mathematical models that make complex assumptions and, therefore, cannot always produce the ideal route. From the user's perspective, it can often be hard to understand a particular route choice without any further explanation as to why specific paths have been chosen. This is a problem for users, especially if they are familiar with the area and already have a preferred route. Thus, to build trust in the routing, it is vital to provide additional route details to allow users to make informed routing decisions.

\begin{figure}[htbp]
\centering
\includegraphics[width=\linewidth]{images/graphhopper-data-flow.png}
\caption{Visualization and fetching of alternative routes and other metadata.}
\label{fig:graphhopper-data-flow}
\end{figure}

To support users and make the route decision process more transparent, additional information is provided about the surface type, elevation, and road classes along the route so that the user can form their own opinions about the suitability of the chosen route. All of this information is fetched from the routing engine, as highlighted in \Cref{fig:graphhopper-data-flow}.

\paragraph{Traffic Flow Prediction:} In addition to the path's surface information and inclination, the traffic density may also have a large impact on the ride's perceived comfortability and safety. Google Maps has addressed this problem by showing users a predicted traffic density for the following hours. The foundation for these calculations is floating data: "To determine popular times, wait times, and visit duration, Google uses aggregated and anonymized data from users who have opted in to Google Location History."\footnote{Source: \url{https://support.google.com/maps/answer/11323117?hl=en}} To adopt a similar solution without relying on a large user base, we can make use of open floating car data from the company INRIX provided through the TraffGo Road GmbH (see \Cref{fig:traffic-density-prediction}). The publicly available dataset "Verkehrslage Hamburg" is updated every five minutes and contains a current traffic density status for each path in Hamburg: free-flow, dense, heavy, and congested traffic. Based on this data, a traffic flow prediction for Hamburg is designed.

\begin{figure}[htbp]
\centering
\includegraphics[width=\linewidth]{images/traffic-density-prediction.pdf}
\caption{Data flow of traffic density prediction toward the app.}
\label{fig:traffic-density-prediction}
\end{figure}

To obtain an overall traffic flow factor $\text{Flow}$ for Hamburg, the following algorithm is designed. Let $P$ be the set of all paths in the "Verkehrslage Hamburg" dataset, and $n$ be the number of paths in $P$. For each path $i$ in $P$, let:

\begin{itemize}
    \item $L_i$ be the length of path $i$.
    \item $W_i$ be the weight associated with path $i$: congested $\rightarrow 0$, heavy $\rightarrow 1/3$, dense $\rightarrow 2/3$, and free-flow $\rightarrow 1$
\end{itemize}

The total length $L_\text{network}$ of all paths is given by: $L_\text{network} = \sum_{i \in P} L_i$. Then, the score $S_i$ of each path in relation to the complete network is calculated as $S_i = \frac{L_i}{L_\text{network}} \times W_i$. Now, the resulting $\text{Flow}$ is the sum of all scores: $\text{Flow} = \sum_{i \in P} S_i$. 

The value of $\text{Flow}$ is always in $[0, 1]$, where 0 indicates complete congestion of all roads, and 1 indicates free flow on all roads. In Hamburg, typical values lie within 0.94 (maximum traffic) and 0.99 (minimum traffic). This empirically defined boundary defines the min-max scaling of the user interface as highlighted in \Cref{fig:traffic-density-prediction}. This means that values of 0.94 will be displayed as a full-height bar, and 0.99 will be displayed as a bar with 0 height. 

To predict the traffic flow, a history is persisted for every hour and weekday. Now, each hour is predicted through the arithmetic mean of all previously recorded hours on the same weekday. If the service starts freshly and has no recording of the same weekday, the hourly average is calculated by all other available weekdays. The generated prediction contains the current measured $\text{Flow}$ value, as well as predicted values for the previous, current, and next 5 hours. The continuously updated JSON data is served through a web proxy to the mobile app.


\begin{figure}[htbp]
\centering
\includegraphics[width=\linewidth]{images/home-view-prediction-quality.png}
\caption{Prediction quality visualized in the GLOSA app for enhanced explainability.}
\label{fig:home-view-prediction-quality}
\end{figure}

Not all traffic lights in Hamburg are available for prediction. Those who are available may occasionally lose data, which error detection can partially address. Another important factor, however, is the user's perspective on the data availability. Since a degraded prediction availability will also negatively impact usability, some ideas must be found that mitigate potential disappointments on the user side. One idea implemented in the GLOSA app is increasing the explainability of the prediction system. The existing monitoring infrastructure is extended such that users can also access information about the current availability. Through the app, users can inform themselves about the current percentage of available predictions and the spatial distribution of good and bad predictions on the map. The resulting user interface shown in \Cref{fig:home-view-prediction-quality} is intended to allow users to identify faults at an early stage and then switch to an alternative app, avoiding frustration caused by missing or incorrect predictions.

\paragraph{Bike-Specific Points of Interest:} Routes can only be calculated if the users define their destination or multiple waypoints. Thus, users have to be given the option to look up places through the app. One option is to pinpoint a location on the in-app map. Here, it is vital to provide more information than just the base map layer. For example, Google Maps highlights specific places, such as busy areas, to improve the map's informativeness. In the designed solution, the focus lies on bike-specific points of interest, such as repair shops, parking spots, rental stations, and air pumps. A traffic layer is also provided, which indicates congested roads. Velo routes and static bike green waves (at 18 km/h) are also displayed to highlight public initiatives to make cycling more attractive. Furthermore, construction sites and accident hotspots can be marked on the map, providing enhanced awareness of potentially dangerous spots.

\begin{figure}[htbp]
\centering
\includegraphics[width=\linewidth]{images/points-of-interest.png}
\caption{Hierarchical fade-in schema for map layers.}
\label{fig:points-of-interest}
\end{figure}

With this number of different points of interest, the risk of cluttering the map is high. Especially bike parking spots are present in large numbers all over the city. To circumvent this problem, the draw distances of map layers are ordered using a hierarchical schema. This hierarchical schema is highlighted in \Cref{fig:points-of-interest}. Points of interest that may potentially impact the cyclist's route choice are visible when zoomed out, while points of interest that are typically more relevant in proximity to the user are only displayed once zoomed in. Accident hotspots represent a special role and are displayed from farther out to further emphasize them on the map.

\paragraph{Accident hotspot extraction:} Under supervision, Markus Wieland \cite{wieland_2022} designed an accident hotspot extraction procedure based on the Unfallatlas\footnote{\url{https://unfallatlas.statistikportal.de/}} dataset. Bike accidents are extracted from the dataset and clustered, adding up the total number of bike accidents for each cluster. The resulting cluster accident counts are subjected to a threshold and, if exceeding this threshold, marked as accident hotspots.

\paragraph{Geocoding:} To create human-readable waypoints and search for places, a geocoding service is required to convert textual input into geospatial coordinates (geocoding). Likewise, when the user taps on the map to add a new waypoint, a similar service is needed to translate the coordinates into an address for the route planning view (reverse geocoding).

\begin{figure}[htbp]
\centering
\includegraphics[width=\linewidth]{images/routing-view-geocoding.png}
\caption{(Reverse) geocoding via Photon for location search and map pinning.}
\label{fig:routing-view-geocoding}
\end{figure}

Initially, Nominatim was chosen as a geocoding service based on OpenStreetMap. However, the solution has shown limitations when it comes to supporting partial queries, such as searching for "University" using "Univers", and its response time was perceived as too slow (often more than 2 seconds) during preliminary tests. Therefore, as shown in \Cref{fig:routing-view-geocoding}, the decision was made to switch to Photon (by Komoot) as an alternative open-source solution that supports partial queries and provides faster query execution based on an ElasticSearch database.

\subsection{Final Application Architecture and Design}

\begin{figure}[htbp]
\caption{Final application infrastructure.}\label{fig:architecture}
\includegraphics[width=\linewidth]{images/architecture.png}
\end{figure}

\Cref{fig:architecture} highlights the final service infrastructure that combines the developed solutions. The first key solution to make a bike-GLOSA app practical in a real-world urban environment is handling massive amounts of traffic light data. A prediction infrastructure (blue) is proposed that maximizes data ingress stability and self-monitors prediction qualities and availability. These metrics are used within the mobile application to adapt the speed advisory user interface and inform users about data outages.

A speed advisory user interface (the Ride View) is designed that utilizes the speedometer projection to give users a free choice of the desired speed. Uncertainties in the prediction are visualized to enhance the speed advisory's trustworthiness. To make the speed advisory practical, a user-defined route is used for distance-to-signal estimation, traffic light matching, battery-efficient GNSS error correction, and a camera controller for improved traffic light visibility. Combining the speed advisory system with a navigation solution is another key idea to enable these methods and make the mobile application useful in the absence of traffic light predictions.

To deliver bike navigation, a routing infrastructure (orange) is implemented that provides personalized, accurate, and metadata-enhanced bike routing. Once waypoints are found using the Geocoding Service and the Map Data Service that delivers bike-specific points of interest, an accurate bike route is calculated through the developed DRN approach. Route metadata and the predicted traffic situation are visualized to allow for a more informed routing decision. Generated routes are marked green at spots where users can expect a speed advisory. The routing material's actuality is ensured through an automated update CI/CD pipeline. 

The final key solution that connects the speed advisory to the routing is route-based traffic light matching. Multiple approaches were tested, coming to a final machine-learning-based method that compares geometric features between the traffic light geometries and the route geometry to decide which sequence of signals will be passed along the trajectory. To avoid giving a speed advisory for the wrong intersection, unconnected intersections are detected and also matched along the route.

Finally, a tracking service is implemented that obtains ride statistics from users. The collected telemetry data is used to conduct post-hoc analyses on the actual impact of bike-GLOSA on ride behavior. \Cref{ch:results} will focus on the analysis of this data.

\begin{figure}[htbp]
\caption{The PrioBike app's main view flow.}\label{fig:app}
\includegraphics[width=\linewidth]{images/app.png}
\end{figure}

What's visible to the user is an application similar to other navigation apps like Google Maps or Komoot, with added speed advisory functionality. \Cref{fig:app} shows how the designed user interface components are combined into a cohesive application flow concept. From the Home view, which allows users to inform themselves about the current prediction status, users can personalize their routing profile and open the Routing view. This view provides the described route planning functionality. Finally, users can start a ride to obtain the discussed speed advisory. A summary is given after the ride, together with the option to rate the application experience. This rating, together with the collected ride and prediction data, is sent to the tracking service in an optionally offloaded upload routine.

The final application is distributed to real-world test users in Hamburg, who can freely use the app throughout the city to provide realistic experimental circumstances for the urban cycling setting. Based on the collected data, surveys, and other experiments, the next goal is to determine the impacts of such a solution. These aspects will be discussed in the following chapter.

\section{Results}

\subsection{Usability}

- SUS Score
- Interaction during ride
- General user feedback

\subsection{Impact on Approach Speed, Stop Time, and Energy Expenditure}

- Nr of trajectories, how many users, usage over time, ...

\begin{figure}[t]
\caption{T.}\label{fig:}
\includegraphics[width=\linewidth]{images/impacts-activation-distances.pdf}
\end{figure}

\begin{figure}[t]
\caption{T.}\label{fig:}
\includegraphics[width=\linewidth]{images/impacts-adherence.pdf}
\end{figure}

\begin{figure}[t]
\caption{T.}\label{fig:}
\includegraphics[width=\linewidth]{images/impacts-approach-speed.pdf}
\end{figure}

\begin{figure}[t]
\caption{T.}\label{fig:}
\includegraphics[width=\linewidth]{images/impacts-approach-speed-heatmap.pdf}
\end{figure}

\begin{figure}[t]
\caption{T.}\label{fig:}
\includegraphics[width=\linewidth]{images/impacts-stop-time-adherence.pdf}
\end{figure}

\section{Conclusions}
